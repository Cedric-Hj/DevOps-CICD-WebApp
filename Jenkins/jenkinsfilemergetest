pipeline {
    agent any
    
    stages {
        stage('Checkout and Prepare') {
            steps {
                script {
                    // Checkout dev branch and create temp-branch
                    git branch: 'dev', url: 'git@github.com:Cedric-Hj/DevOps-CICD-WebApp.git'
                    sh '''
                        git checkout -b temp-branch
                        git checkout dev -- src
                        git commit -m "Temporary commit for src folder" || echo "No changes to commit"
                        git checkout test
                        git merge temp-branch --no-ff -m "Merged src folder from dev branch" || echo "No changes to merge"
                    '''
                }
            }
        }
        
        stage('Push Changes') {
            steps {
                // Push changes to test branch
                sh 'git push origin test'
            }
        }
    }
    
    post {
        always {
            // Clean up temp branch
            sh 'git branch -D temp-branch || true'
        }
    }
}
